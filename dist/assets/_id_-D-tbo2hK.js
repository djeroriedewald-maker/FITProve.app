import{r as c,j as s,e as B,b as q}from"./index-BZn6MCEi.js";import{g as E,a as D,c as L,b as F,s as R}from"./workouts-client-Cg9OSv1j.js";function j(a,d){return`${a}:${d}`}function $(a){if(a===""||a==null)return null;const d=Number(a);return Number.isFinite(d)?d:null}function U({session:a,exercises:d,onSaveSet:v,loadSets:l,completeSession:M,onCompleted:k}){const[_,x]=c.useState(new Map),[N,g]=c.useState(new Map),[h,y]=c.useState(null),[z,w]=c.useState(!1);c.useEffect(()=>{let e=!0;return(async()=>{try{const n=await l(a.id);if(!e)return;const i=new Map;for(const r of n)i.set(j(r.exercise_id,r.set_index),{reps:r.reps??null,weight_kg:r.weight_kg??null,time_seconds:r.time_seconds??null,rpe:r.rpe??null,notes:r.notes??null,completed:r.completed??null});x(i),g(new Map(i))}catch{}})(),()=>{e=!1}},[a.id,l]);const S=c.useMemo(()=>{const e=new Map;for(const n of d){let i=Math.max(2,n.target_sets??0);for(const r of _.keys()){const[o,m]=r.split(":");if(o===n.id){const p=Number(m);p+1>i&&(i=p+1)}}e.set(n.id,i||2)}return e},[d,_]);function C(e,n){return N.get(j(e,n))??{}}function f(e,n,i){g(r=>{const o=j(e,n),p={...r.get(o)??{},...i},u=new Map(r);return u.set(o,p),u})}async function b(e,n){const i=j(e,n),r=N.get(i)??{};y(i);try{const o={session_id:a.id,exercise_id:e,set_index:n,reps:r.reps??null,weight_kg:r.weight_kg??null,time_seconds:r.time_seconds??null,rpe:r.rpe??null,completed:r.completed??null,notes:r.notes??null};await v(o),x(m=>{const p=new Map(m);return p.set(i,{...r}),p})}finally{y(o=>o===i?null:o)}}async function t(){try{w(!0);const e=await M(a.id);k(e)}finally{w(!1)}}return s.jsxs("section",{className:"mt-6 space-y-4",children:[s.jsx("h2",{className:"text-xl font-semibold",children:"Log je workout"}),d.map(e=>{const n=S.get(e.id)??2;return s.jsxs("div",{className:"rounded-2xl border border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900",children:[s.jsxs("div",{className:"p-3 flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("div",{className:"font-medium",children:e.display_name}),s.jsxs("div",{className:"text-xs text-zinc-600 dark:text-zinc-400",children:[(e.target_sets??"")&&`${e.target_sets} sets`," ",(e.target_reps??"")&&`• ${e.target_reps} reps`," ",(e.rest_seconds??"")&&`• Rust ${e.rest_seconds}s`]})]}),s.jsx("div",{className:"text-xs text-zinc-500",children:e.tempo?`Tempo ${e.tempo}`:""})]}),s.jsx("div",{className:"divide-y divide-zinc-200 dark:divide-zinc-800",children:[...Array(n)].map((i,r)=>{const o=C(e.id,r),m=j(e.id,r),p=h===m;return s.jsxs("div",{className:"grid grid-cols-5 gap-2 p-3 items-center",children:[s.jsxs("div",{className:"text-sm",children:["Set ",r+1]}),s.jsx("input",{className:"h-9 rounded-lg border px-2 text-sm bg-white dark:bg-zinc-900 border-zinc-300 dark:border-zinc-700",placeholder:"Reps",value:o.reps??"",onChange:u=>f(e.id,r,{reps:$(u.target.value)}),onBlur:()=>void b(e.id,r),inputMode:"numeric"}),s.jsx("input",{className:"h-9 rounded-lg border px-2 text-sm bg-white dark:bg-zinc-900 border-zinc-300 dark:border-zinc-700",placeholder:"Gewicht (kg)",value:o.weight_kg??"",onChange:u=>f(e.id,r,{weight_kg:$(u.target.value)}),onBlur:()=>void b(e.id,r),inputMode:"decimal"}),s.jsx("input",{className:"h-9 rounded-lg border px-2 text-sm bg-white dark:bg-zinc-900 border-zinc-300 dark:border-zinc-700",placeholder:"Tijd (s)",value:o.time_seconds??"",onChange:u=>f(e.id,r,{time_seconds:$(u.target.value)}),onBlur:()=>void b(e.id,r),inputMode:"numeric"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",className:"h-4 w-4 accent-orange-500",checked:!!o.completed,onChange:u=>f(e.id,r,{completed:u.target.checked}),onBlur:()=>void b(e.id,r)}),s.jsx("span",{className:"text-xs",children:p?"Opslaan…":"Voltooid"})]})]},r)})})]},e.id)}),s.jsx("div",{className:"pt-2",children:s.jsx("button",{type:"button",onClick:()=>void t(),disabled:z,className:"px-4 py-2 rounded-xl bg-emerald-600 text-white hover:bg-emerald-700 disabled:opacity-60",children:z?"Afronden…":"Sessie afronden"})})]})}function V(...a){for(const d of a)if(d!=null)return d}function G(){const{id:a}=B(),{search:d}=q(),v=new URLSearchParams(d).get("sid")||void 0,[l,M]=c.useState(null),[k,_]=c.useState([]),[x,N]=c.useState([]),[g,h]=c.useState(null),[y,z]=c.useState(!0),[w,S]=c.useState(null);c.useEffect(()=>{let t=!0;return(async()=>{try{if(!a)throw new Error("Geen id.");const e=await E(a);if(!t)return;M(e.workout),_(e.blocks||[]),N(e.exercises||[]),v&&h({id:v,workout_id:a,user_id:"me",status:"active",started_at:new Date().toISOString(),completed_at:null,duration_sec:null})}catch(e){if(!t)return;S((e==null?void 0:e.message)??"Kon workout niet laden.")}finally{t&&z(!1)}})(),()=>{t=!1}},[a,v]);const C=c.useMemo(()=>{const t=new Map;for(const e of x){const n=e.block_id;t.has(n)||t.set(n,[]),t.get(n).push(e)}for(const e of t.values())e.sort((n,i)=>(n.sequence??0)-(i.sequence??0));return t},[x]);async function f(){try{if(!a)return;const t=await R(a);h(t),window.requestAnimationFrame(()=>{try{window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})}catch{}})}catch(t){S((t==null?void 0:t.message)??"Kon sessie niet starten.")}}function b(t){var e,n,i,r,o,m;return V((n=(e=t.media)==null?void 0:e.videos)==null?void 0:n[0],(r=(i=t.media)==null?void 0:i.gifs)==null?void 0:r[0],(m=(o=t.media)==null?void 0:o.images)==null?void 0:m[0],t.video_url??void 0,t.gif_url??void 0,t.image_url??void 0,t.thumbnail??void 0)}return y?s.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-6 space-y-3",children:[s.jsx("div",{className:"h-8 w-48 rounded bg-zinc-200 dark:bg-zinc-800 animate-pulse"}),s.jsx("div",{className:"h-24 rounded-2xl bg-zinc-100 dark:bg-zinc-800 animate-pulse"}),s.jsx("div",{className:"h-24 rounded-2xl bg-zinc-100 dark:bg-zinc-800 animate-pulse"})]}):w?s.jsx("div",{className:"max-w-3xl mx-auto px-4 py-6",children:s.jsx("p",{className:"text-red-600 dark:text-red-400",children:w})}):l?s.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-4",children:[s.jsxs("div",{className:"rounded-2xl bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 p-4 shadow-sm",children:[s.jsx("h1",{className:"text-2xl font-bold",children:l.title}),l.description?s.jsx("p",{className:"text-zinc-600 dark:text-zinc-400 mt-1",children:l.description}):null,s.jsxs("div",{className:"text-sm mt-2 flex flex-wrap gap-3",children:[s.jsxs("span",{children:["Doel: ",l.goal??"-"]}),s.jsxs("span",{children:["Niveau: ",l.level??"-"]}),s.jsxs("span",{children:["Locatie: ",l.location??"-"]}),s.jsxs("span",{children:["Duur: ",l.duration_minutes??0," min"]}),s.jsxs("span",{children:["Materiaal: ",l.equipment_required?"ja":"nee"]})]}),!g&&s.jsx("div",{className:"mt-4",children:s.jsx("button",{type:"button",onClick:f,className:"px-4 py-2 rounded-xl bg-orange-600 text-white hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-orange-500/30 shadow-sm",children:"Start workout"})})]}),!g&&k.length>0&&s.jsx("div",{className:"mt-6 space-y-4",children:k.slice().sort((t,e)=>t.sequence-e.sequence).map(t=>s.jsxs("div",{className:"rounded-2xl border border-zinc-200 dark:border-zinc-800 bg-white/70 dark:bg-zinc-900/60 p-4",children:[s.jsx("div",{className:"font-semibold",children:t.title??`Circuit ${t.sequence}`}),t.note?s.jsx("p",{className:"text-sm text-zinc-600 dark:text-zinc-400",children:t.note}):null,s.jsx("div",{className:"mt-2 space-y-2",children:(C.get(t.id)??[]).map(e=>{const n=b(e),i=[];return e.target_sets&&i.push(`${e.target_sets}×`),e.target_reps&&i.push(`${e.target_reps} reps`),e.target_time_seconds&&i.push(`${e.target_time_seconds}s`),e.rest_seconds&&i.push(`Rust ${e.rest_seconds}s`),s.jsxs("div",{className:"flex items-center justify-between rounded-xl border border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900 p-3",children:[s.jsxs("div",{children:[s.jsx("div",{className:"font-medium",children:e.display_name}),s.jsx("div",{className:"text-xs text-zinc-600 dark:text-zinc-400",children:i.join(" • ")})]}),s.jsx("div",{className:"flex items-center gap-2",children:n?s.jsx("a",{href:n,target:"_blank",rel:"noreferrer",className:"text-xs rounded-lg px-2 py-1 border border-zinc-300 dark:border-zinc-700 hover:bg-zinc-50 dark:hover:bg-zinc-800",title:"Voorbeeld openen",children:"Voorbeeld"}):s.jsx("span",{className:"text-xs opacity-50",children:"Geen media"})})]},e.id)})})]},t.id))}),g&&s.jsx("div",{className:"mt-6",children:s.jsx(U,{session:g,exercises:x,onSaveSet:t=>D(t),loadSets:async t=>(await F(t)??[]).filter(n=>typeof(n==null?void 0:n.exercise_id)=="string").map(n=>({session_id:String(n.session_id),exercise_id:String(n.exercise_id),set_index:Number(n.set_index??0),reps:n.reps??null,weight_kg:n.weight_kg??null,time_seconds:n.time_seconds??null,rpe:n.rpe??null,notes:n.notes??null,completed:n.completed??null})),completeSession:async t=>{const e=await L(t);return h(e),e},onCompleted:t=>h(t)})})]}):s.jsx("div",{className:"max-w-3xl mx-auto px-4 py-6",children:s.jsx("p",{className:"opacity-70",children:"Workout niet gevonden."})})}export{G as default};
